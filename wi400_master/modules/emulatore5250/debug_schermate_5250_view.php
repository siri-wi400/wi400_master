<?php

	if(in_array($form, array("DEFAULT", "LISTA"))) {
		$searchAction = new wi400Detail($azione."_PARAM", false);
		$searchAction->setColsNum(2);
		
		// Data ricezione iniziale
		$myField = new wi400InputText('DATA_INI');
		$myField->setValue(date('d/m/Y'));
		$myField->addValidation('date');
		$myField->addValidation('required');
		$myField->setLabel("Data ricezione iniziale");
		$searchAction->addField($myField);
		
		//Ora ricezione iniziale
		$myField = new wi400InputText('ORA_INI');
		$myField->setLabel("Ora ricezione iniziale");
		$myField->setValue("00:00");
		$myField->addValidation('time');
		$myField->addValidation('required');
		$searchAction->addField($myField);
		
		// Data ricezione finale
		$myField = new wi400InputText('DATA_FIN');
		$myField->setValue(date('d/m/Y'));
		$myField->addValidation('date');
		$myField->addValidation('required');
		$myField->setLabel("Data ricezione finale");
		$searchAction->addField($myField);
		
		//Ora ricezione finale
		$myField = new wi400InputText('ORA_FIN');
		$myField->setLabel("Ora ricezione finale");
		$myField->setValue("23:59");
		$myField->addValidation('required');
		$myField->addValidation('time');
		$searchAction->addField($myField);
		
		// Seleziona
		$myButton = new wi400InputButton('SEARCH_BUTTON');
		$myButton->setLabel("Seleziona");
		$myButton->setAction($azione);
		$myButton->setForm("LISTA");
		$myButton->setValidation(true);
		$searchAction->addButton($myButton);
		
		$searchAction->dispose();
	}
	
	if($form == "LISTA") {
		echo "<br/>";
		
		$miaLista = new wi400List($azione."_LIST", !$isFromHistory);
		$miaLista->setSelection("MULTIPLE");
		
		$miaLista->setField("logsro, hex(logsdt) DATI, LOGSTM, LPGTAG, LOGLEN");
		$miaLista->setFrom("zopnlogs"); //openterm/zopnlogs
		$miaLista->setWhere(implode(" and ", $where));
		$miaLista->setOrder("LOGSTM");
		
		$miaLista->setCols(array(
			new wi400Column("LOGSTM", "Timestamp", "", "left", "", TRUE),
			new wi400Column("LOGSRO", "Read/Write"),
			new wi400Column("LPGTAG", "Tag"),
			new wi400Column("DATI", "Dati"),
		));
		
		//mostra schermata
		$action = new wi400ListAction();
		$action->setAction($azione);
		$action->setForm("MONITOR");
		$action->setLabel("Mostra schermata");
		$action->setSelection("MULTIPLE");
		$miaLista->addAction($action);
		
		//mostra schermata
		$action = new wi400ListAction();
		$action->setAction($azione);
		$action->setForm("MONITOR");
		$action->setLabel("Mostra in finestra");
		$action->setSelection("MULTIPLE");
		$action->setTarget("WINDOW", 1100, 800);
		$miaLista->addAction($action);
		
		// Elimina selezion
		$action = new wi400ListAction();
		$action->setAction($azione);
		$action->setForm("ELIMINA");
		$action->setLabel("Elimina");
		$action->setSelection("MULTIPLE");
		$miaLista->addAction($action);
		
		// Dettaglio log web service
		$action = new wi400ListAction();
		$action->setAction($azione);
		$action->setForm("ELIMINA_TUTTO");
		$action->setLabel("Elimina tutto");
		$action->setConfirmMessage("Sicuro di voler eliminare tutto?");
		$action->setSelection("NONE");
		$miaLista->addAction($action);
		
		$miaLista->addKey("LOGSTM");
		$miaLista->addKey("LOGSRO");
		$miaLista->addKey("DATI");
		$miaLista->addKey("LOGLEN");
		
		$filter = new wi400Filter("LPGTAG", "Ricerca tag");
		$filter->setFast(true);
		$miaLista->addFilter($filter);
		
		$miaLista->dispose();
	}else if($form == "MONITOR") {
		
		$detail = new wi400Detail($azione."_INFO");
		$detail->setColsNum(2);
		
		$myField = new wi400Text("TIMESTAMP", "Timestamp", $field_300);
		$detail->addField($myField);
		
		if($tagname) {
			$myField = new wi400Text("TAGNAME", "Tag", $tagname);
			$detail->addField($myField);
		}
		
		/*$button = new wi400InputButton("ADD_TAG");
		$button->setLabel("Aggiungi tag");
		$button->setAction($azione);
		$button->setForm("ADD_TAG");
		$button->setTarget("WINDOW");
		$detail->addButton($button);*/
		if(!isset($_REQUEST['WI400_IS_WINDOW'])) {
			$detail->dispose();
			echo "<br/>";
		}
			
		echo getTema5250();
		//echo '<link rel="stylesheet" type="text/css" href="modules/emulatore5250/telnet_5250_griglia.css">';

		echo "<script>var disableAjax = true;</script>";
		require_once "telnet_5250_script.php";
		//echo '<script type="text/javascript" src="modules/emulatore5250/jquery.ba-hashchange.js"></script>';
		
		disableInputFocusStyle();
		
		$Sessione5250 = new wi400AS400Session(session_id());
		//$Sessione5250->openTerminalConnection();
		
		// Cicolo di lettura della maschera
		//$display = $Sessione5250->manage5250();
		
		
		/*$dati = '3044004110028010700000018000E061104211D602089883000021105211D602089883000021106211D602089883000021106241D602089883000021106271D630089883000071107211D602089883000011107271D630089883000071108211D602089883000011108261D630089883000161109261D63008988300016110A211D60208988300001110A261D63008988300016110B211D63058988300007110B371D63058988300007110C211D60208988300004110D211D60208988300004110E211D6020898830000E110E301D63008988220003110E37150041D950066400110184840000150101010000001301E000210021003B22202020203A2420203A1A100000E0C485A2839989A98996958540E389979693968789811110211D602089883000041111151D6020898830000111111D15003AD9500664001101848400000E0101010000001301E000210021003B22202020203A2420203A13100000E0E2838593A38140D581A98996958511113C1D60208988300014111801150041D950060280412131320000090102010000001301E000210022003B22202023203A2420203A0D100400E0F140C995A58996400D100400E033C6F37EC68995851101013AE2C9D9C9F0F1404040D8D7C1C4C5E5F0F0F0D840F4F7F6F3F7F840F9F0F0F040E5C5C7C140E2D6C3C9C5E3C17D40C3D6D6D7C5D9C1E3C9E5C1409F22F0F261F0F561F1F838F1F07AF1F226E2899989201102013EC481A38940C689A283819389404040404040404040404040404040F9F0F04040E5C5C7C1D5C5E64040404040404040E3C5E2E340E2E440E2C9D9C94040404040F5F0F0F94040404040D9D4C3C2C6C92011030120C199A389839693967A2011030B22F0F0F0F0F0F1F82011031322C7C1C2C2C9C140C6C5D9D9D640D7C9C3C3D6D3C1020336002011033720C481A38140D98986859989948595A3962011034822F2F361F0F361F1F72011040120C38440C9A581404B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B7A2011042130F7F01104252240404040402011042B22C5E2C3D3E4E2C140C1D9E34BF1F52011043A20E58193898496408481937A201104462240F12011044922F1F02011044C22F2F0F1F32011050120C38440C9A581408193A385999581A389A59640C1838385A2A2969989404B7A2011052130F2F211052522F2F26BF0F02011052B22C1D3C9D8E4D6E3C140F2F2406C40201105422081937A2011054622F9F92011054922F9F92011054C22F9F9F9F92011060120E5968385406140E44BD44B406140C7998194944B40E4E3C9C6404B4B4B4B7A2011062130E5E411062430D7E9110627304040404040F14011062F22E5E4D6E3C961C3C1E4E9C9D6D5C92011063E22D7C5E9E9C902064C002011070120E381A2A28140899540D78599838595A3A4819385404B4B4B4B4B4B4B4B4B7A201107213002072200110727304040404040404011073D2202074B002011080120E381A2A281408140E58193969985404B4B4B4B4B4B4B4B4B4B4B4B4B4B4B7A201108213002082200110826304040404040404040404040404040404040404040404011083D2202084B00201109012060C4894083A48940E581939699854089949796A2A38140C9C6C1404B4B4B7A201109263040404040404040404040404040404040404040404040110A0120E5819396998540839695A3998982A4A39640C3D6D5C1C9404B4B4B4B4B4B7A20110A2130020A2200110A263040404040404040404040404040404040404040404040110A3D22D596020A4B0020110B0120C79981844B958540C1938396969389838140E589958961D38998A49699897A20110B213040404040404040110B2B2084859581A3A49981A3897A20110B373040F9F06BF1F040110C0120C396844BD79996A58595898595A98140A589958940C4968361C4968387407A20110C2130020C2500110C2622020C4E0020110D0120C381A385879699898540E58995894085619640D496A2A389404B4B4B4B4B7A20110D2130020D2500110D2622020D4E0020110E0120E3899796939687898140C4D6C36B40C4D6C3C7408540C9C7E3404B4B4B4B7A20110E2130020E2F00110E3022404040110F0122020F50002011100120D581A98996958540848940D6998987899585404B4B4B4B4B4B4B4B4B4B4B7A2011102130021025001110263AE4C502102E00201110302202104E002011110120D68282934BC38599A389864BE2819589A34B7A20111115300211160011111722D5962011113020E2A381824BD79996844B7A2011113C30021150001112012540404040404040404040404040404040404040404040404040404040C481408489838889819981A98996958540948599838596939687898381404040404040404040404040404040404040404040402011130120E296A3A39686819489879389817A2011131122F8F8F8F8F8F802131D002011131F22C3C1E4E9C9D6D5C940C540E5E4D6E3C9404040402011140120C3968489838540C9E5C1404B4B4B4B4B4B4B4B4B7A201114172240402011141A2240404040402011142820D59640A381A2A28140A581934B4020111437204B4B4B4B4B7A2011143E22402011144120D481A77A20111446224040404040404040402011150120E4E3C9C6404B4B4B4B4B4B4B4B4B4B4B4B4B4B4B7A2011151722E5E42011151A2240402011152820C9C6C1404B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B7A2011153E22F02011154122D5962011160120D59640A381A2A28140978599834B20111610204B4B4B4B4B7A2011161722402011161A20D481A77A2011161F224040404040402011162820E589958940C4D6C3404B4B4B4B4B4B4B4B4B4B4B7A2011163E2240201116412240402011170120C39695A3998982A4A39640C3D6D5C1C9404B4B4B7A2011171722402011171A22D59602172800200452';
		$dati .= '0000404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';
		$dati .= '4040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';
		$dati .= '40404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';*/
		
		
		/*$dati = '304110028010700000010000000110607150009D9518000000A0A11080A20C6899585A2A3998120110D0C20D79996A5812013070A04520000404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';
		$dati .= '404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';
		$dati .= '404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';
		$dati .= '40404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';
		$dati .= '4040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040404040';*/
		$obj = $Sessione5250->parseDataStream($dati);
		
		showArray($obj);
		
		$resolution = $Sessione5250->getResolutionRow()."x".$Sessione5250->getResolutionCol();
		$display = new wi400AS400Display(session_id());
		$display->setDisposeContainer(true);
		$display->setDisposeFunctionButton(true);
		$display->setResolution($resolution);
		$display->setStreamObj($obj);
		$display->executeCommand();
		$html = $display->display();
		
		//echo $display->stampaGriglia();
		echo $html;
		
		if(isset($_REQUEST['WI400_IS_WINDOW'])) {
			echo "<br/>";
			$detail->dispose();
		}
	}else if($form == "ADD_TAG") {
		$detail = new wi400Detail($azione."_DETAIL_TAG");
		
		$myField = new wi400InputText("TAGNAME");
		$myField->setLabel("Tag name");
		$myField->setCase("UPPER");
		$detail->addField($myField);
		
		$myField = new wi400InputHidden("DA_DOVE");
		$myField->setValue($_REQUEST['CURRENT_ACTION']);
		$detail->addField($myField);
		
		$button = new wi400InputButton("CONFERMA");
		$button->setLabel("Conferma");
		$button->setAction($azione);
		$button->setForm("SALVA_TAG");
		$detail->addButton($button);
		
		$detail->dispose();
	}else if($form == "MONITOR2") {
		$detail = new wi400Detail($azione."_INFO");
		$detail->setColsNum(2);
		
		$myField = new wi400Text("TIMESTAMP", "Timestamp", $field_300);
		$detail->addField($myField);
		
		if($tagname) {
			$myField = new wi400Text("TAGNAME", "Tag", $tagname);
			$detail->addField($myField);
		}
		
		$button = new wi400InputButton("ADD_TAG");
		$button->setLabel("Aggiungi tag");
		$button->setAction($azione);
		$button->setForm("ADD_TAG");
		$button->setTarget("WINDOW");
		$detail->addButton($button);
		
		$detail->dispose();
		
		echo "<br/>";
		
		//echo '<link rel="stylesheet" type="text/css" href="modules/emulatore5250/telnet_5250_style.css">';
		echo '<link rel="stylesheet" type="text/css" href="modules/emulatore5250/telnet_5250_griglia.css">';
		
		echo "<script>var disableAjax = true;</script>";
		require_once "telnet_5250_script.php";
		
		disableInputFocusStyle();
		
		$Sessione5250 = new wi400AS400Session(session_id());
		
		$obj = $Sessione5250->parseDataStream($dati);
		
		$resolution = $Sessione5250->getResolutionRow()."x".$Sessione5250->getResolutionCol();
		
		$display = new wi400AS400Display(session_id());
		$display->setResolution($resolution);
		$display->setStreamObj($obj);
		$display->executeCommand();
		$display->setDisposeContainer(true);
		$display->setDisposeFunctionButton(true);
		$html = $display->display();
		
		echo $html;
		
		//echo $display->stampaGriglia();
		
		/*echo '<div style="position: relative">
			<div id="CLIENT_5250_DIV" class="display">';
		echo $html;
		echo "
			</div>
			<div class='cont_block'>
				<span id='x_system'>X SYSTEM</span>
			</div>
			<div class='cont_block2'>
				<span id='x_error'>X II</span>
			</div>
		</div>";*/
		
		$html = $display->disposeFunctionButton();
		echo $html;
	}